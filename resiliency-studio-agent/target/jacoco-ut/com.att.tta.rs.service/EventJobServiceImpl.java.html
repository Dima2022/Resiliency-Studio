<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EventJobServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">resiliency-studio-agent</a> &gt; <a href="index.source.html" class="el_package">com.att.tta.rs.service</a> &gt; <span class="el_source">EventJobServiceImpl.java</span></div><h1>EventJobServiceImpl.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 *   BSD License
 *    
 *   Copyright (c) 2017, AT&amp;T Intellectual Property.  All other rights reserved.
 *    
 *   Redistribution and use in source and binary forms, with or without modification, are permitted
 *   provided that the following conditions are met:
 *    
 *   1. Redistributions of source code must retain the above copyright notice, this list of conditions
 *      and the following disclaimer.
 *   2. Redistributions in binary form must reproduce the above copyright notice, this list of
 *      conditions and the following disclaimer in the documentation and/or other materials provided
 *      with the distribution.
 *   3. All advertising materials mentioning features or use of this software must display the
 *      following acknowledgement:  This product includes software developed by the AT&amp;T.
 *   4. Neither the name of AT&amp;T nor the names of its contributors may be used to endorse or
 *      promote products derived from this software without specific prior written permission.
 *    
 *   THIS SOFTWARE IS PROVIDED BY AT&amp;T INTELLECTUAL PROPERTY ''AS IS'' AND ANY EXPRESS OR
 *   IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 *   MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
 *   SHALL AT&amp;T INTELLECTUAL PROPERTY BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 *   PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  LOSS OF USE, DATA, OR PROFITS;
 *   OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 *   CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
 *   ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
 *   DAMAGE.
 *******************************************************************************/

package com.att.tta.rs.service;

import java.net.URL;
import java.util.ArrayList;
import java.util.Comparator;
import java.util.List;
import java.util.concurrent.ConcurrentMap;

import org.joda.time.Duration;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.env.Environment;
import org.springframework.stereotype.Service;

import com.att.tta.rs.model.EventJobDTO;
import com.att.tta.rs.model.EventMonkeyStrategyDTO;
import com.att.tta.rs.util.AppUtil;
import com.google.common.base.Charsets;
import com.google.common.io.Resources;

/**
 * Implementation class for {@link EventJobService}
 * 
 * @author ak983d
 *
 */
@Service(&quot;eventJobService&quot;)
<span class="fc" id="L59">public class EventJobServiceImpl implements EventJobService {</span>
<span class="fc" id="L60">	private static final Logger logger = LoggerFactory.getLogger(EventJobServiceImpl.class);</span>
	private static final String UNIXSCRIPT = &quot;UNIX Script&quot;;
	private static final String ANSIBLESCRIPT = &quot;Ansible Script&quot;;
	private static final String COMPLETESTR = &quot;##Completed##&quot;;
	private static final String PRVKEYSTR = &quot;Private key present executing on the instance &quot;;
	private static final String PDKEYSTR = &quot;password  present executing on the instance &quot;;
	private static final String ANSIBLERRSTR = &quot;Error connecting to Ansible instance server. So Scenario Execution is terminated.&quot;;
	private static final String CONNERR = &quot; Error connecting to instance Name: &quot;;
	private static final String PORTSTR = &quot; and port: 22 and user: &quot;;
	private static final String DISCOVERSTR = &quot;No password and No key present executing on the discovery server &quot;;
	private static final String DISCERR = &quot;No UserId or password found for Discovery Server. So Scenario Execution is terminated.&quot;;
	private static final String IPADD = &quot; IP Address &quot;;

	
	@Autowired
	Environment env;

	@Override
	public void executeJob(EventJobDTO eventJobDTO, ConcurrentMap&lt;String, String&gt; eventData) {
<span class="fc" id="L79">		List &lt;EventMonkeyStrategyDTO&gt; execStrategyList =  new ArrayList&lt;&gt;();</span>
<span class="fc" id="L80">		List &lt;EventMonkeyStrategyDTO&gt; strategyList = eventJobDTO.getEventMonkeyList();</span>
<span class="fc" id="L81">		strategyList.sort(Comparator.comparing(EventMonkeyStrategyDTO::getExecSequence));</span>
<span class="fc" id="L82">		boolean errorFlag = false;</span>
<span class="fc" id="L83">		int prevSeq = -1;</span>
<span class="fc bfc" id="L84" title="All 2 branches covered.">		for (EventMonkeyStrategyDTO dto: eventJobDTO.getEventMonkeyList()){</span>
<span class="fc" id="L85">			int currSeq = Integer.parseInt(dto.getExecSequence());</span>
<span class="pc bpc" id="L86" title="3 of 4 branches missed.">			if (prevSeq == -1 || prevSeq == currSeq){</span>
<span class="fc" id="L87">				execStrategyList.add(dto);</span>
<span class="fc" id="L88">				prevSeq = currSeq;</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">			}else if (prevSeq &lt; currSeq){</span>
<span class="nc" id="L90">				runMonkeyStrategy (eventJobDTO, eventData, execStrategyList);</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">				if (checkError (execStrategyList)){</span>
<span class="nc" id="L92">					errorFlag = true;</span>
<span class="nc" id="L93">					break;</span>
				}
				
<span class="nc" id="L96">				execStrategyList =  new ArrayList&lt;&gt;();</span>
<span class="nc" id="L97">				execStrategyList.add(dto);</span>
<span class="nc" id="L98">				prevSeq = currSeq;</span>
			}
<span class="fc" id="L100">		}</span>
<span class="pc bpc" id="L101" title="2 of 4 branches missed.">		if (!execStrategyList.isEmpty()  &amp;&amp; !errorFlag){</span>
<span class="fc" id="L102">			runMonkeyStrategy (eventJobDTO, eventData, execStrategyList);</span>
		}
		
<span class="pc bpc" id="L105" title="3 of 4 branches missed.">		if (null!= eventJobDTO.getStartTS() &amp;&amp; null != eventJobDTO.getEndTS()){</span>
<span class="nc" id="L106">			String execTime = new Duration(eventJobDTO.getStartTS(), eventJobDTO.getEndTS()).getStandardSeconds() + &quot; seconds. &quot;;</span>
<span class="nc" id="L107">			eventJobDTO.setExecStatus(eventJobDTO.getExecStatus() + &quot;\n&quot; + &quot;Scenario Execution completed in &quot; + execTime + &quot;\n&quot;);</span>
<span class="nc" id="L108">			eventJobDTO.setExecDuration(execTime);</span>
		}
		
<span class="fc" id="L111">		eventData.put(eventJobDTO.getEventId(), eventJobDTO.getExecStatus() + COMPLETESTR);</span>
<span class="fc" id="L112">		eventJobDTO.setExecStatus(&quot;&quot;);</span>
<span class="fc" id="L113">	}</span>

	
	private boolean checkError (List &lt;EventMonkeyStrategyDTO&gt; strategyList){
<span class="nc" id="L117">		boolean errorFlag = false;</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">		for (EventMonkeyStrategyDTO dto : strategyList){</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">			if (&quot;-11&quot;.equalsIgnoreCase(dto.getReturnCode())){</span>
<span class="nc" id="L120">				errorFlag = true;</span>
<span class="nc" id="L121">				break;</span>
			}	
<span class="nc" id="L123">		}</span>
<span class="nc" id="L124">		return errorFlag;</span>
	}
	
	private void runMonkeyStrategy (EventJobDTO eventJobDTO, ConcurrentMap&lt;String, String&gt; eventData, List &lt;EventMonkeyStrategyDTO&gt; strategyList){
<span class="fc" id="L128">		strategyList.parallelStream().forEach(eventMonkeyStrategyDTO -&gt;{</span>
<span class="fc bfc" id="L129" title="All 2 branches covered.">			if (UNIXSCRIPT.equalsIgnoreCase(eventMonkeyStrategyDTO.getMonkeyScriptType())) {</span>
<span class="fc" id="L130">				executeUNIXScript(eventJobDTO, eventData, eventMonkeyStrategyDTO);</span>
<span class="pc bpc" id="L131" title="1 of 2 branches missed.">			} else if (ANSIBLESCRIPT.equalsIgnoreCase(eventMonkeyStrategyDTO.getMonkeyScriptType())) {</span>
<span class="fc" id="L132">				executeAnsibleScript(eventJobDTO, eventData, eventMonkeyStrategyDTO);</span>
			}
<span class="fc" id="L134">		});</span>
		
		/*strategyList.forEach(eventMonkeyStrategyDTO -&gt; {
			ExecutorService service = Executors.newSingleThreadExecutor();
			if (UNIXSCRIPT.equalsIgnoreCase(eventMonkeyStrategyDTO.getMonkeyScriptType())) {
				service.execute(() -&gt; executeUNIXScript(eventJobDTO, eventData, eventMonkeyStrategyDTO));
			} else if (ANSIBLESCRIPT.equalsIgnoreCase(eventMonkeyStrategyDTO.getMonkeyScriptType())) {
				service.execute(() -&gt; executeAnsibleScript(eventJobDTO, eventData, eventMonkeyStrategyDTO));
			}
			service.shutdown();
		});*/
<span class="fc" id="L145">	}</span>
	/**
	 * This method is used to execute a UNIX Shell Script
	 * 
	 * @param eventJobDTO
	 * @param eventData
	 * @return
	 */
	private void executeUNIXScript(EventJobDTO eventJobDTO, ConcurrentMap&lt;String, String&gt; eventData, EventMonkeyStrategyDTO eventMonkeyStrategyDTO) {
		String execStatus;
<span class="fc" id="L155">		StringBuilder statusStringBuilder = new StringBuilder();</span>
<span class="fc" id="L156">		boolean pdExecution = true;</span>
<span class="fc" id="L157">		boolean discoverExecution = false;</span>
		AppUtil appUtil;

<span class="pc bpc" id="L160" title="2 of 4 branches missed.">		String conParam = (eventJobDTO.getHostName() != null &amp;&amp; eventJobDTO.getHostName().trim() != &quot;&quot;)</span>
<span class="pc" id="L161">				? eventJobDTO.getHostName() : eventJobDTO.getIpAdd();</span>

<span class="pc bpc" id="L163" title="1 of 4 branches missed.">		if (eventJobDTO.getPrivateKey() != null &amp;&amp; !eventJobDTO.getPrivateKey().trim().isEmpty()) {</span>
<span class="fc" id="L164">			logger.debug(PRVKEYSTR);</span>
<span class="fc" id="L165">			execStatus = PRVKEYSTR + eventJobDTO.getHostName() + IPADD + eventJobDTO.getIpAdd();</span>
<span class="fc" id="L166">			pdExecution = false;</span>
<span class="fc bfc" id="L167" title="All 2 branches covered.">		} else if (checkPwdCondition(eventJobDTO)) {</span>
<span class="fc" id="L168">			logger.debug(PDKEYSTR);</span>
<span class="fc" id="L169">			execStatus = PDKEYSTR + eventJobDTO.getHostName() + IPADD + eventJobDTO.getIpAdd();</span>
<span class="fc" id="L170">			pdExecution = true;</span>
		} else {
<span class="pc bpc" id="L172" title="1 of 4 branches missed.">			if (eventJobDTO.getDiscoverUserId() == null || eventJobDTO.getDiscoverPassword() == null) {</span>
<span class="fc" id="L173">				execStatus = DISCERR;</span>
				
<span class="fc" id="L175">				eventMonkeyStrategyDTO.setExecStatus(eventMonkeyStrategyDTO.getExecStatus() + &quot;\n&quot; + execStatus);</span>
<span class="fc" id="L176">				eventJobDTO.setExecStatus(eventJobDTO.getExecStatus() + &quot;\n&quot; + execStatus);</span>
<span class="fc" id="L177">				eventData.put(eventJobDTO.getEventId(), eventJobDTO.getExecStatus());</span>
				
<span class="fc" id="L179">				eventJobDTO.setReturnCode(&quot;-11&quot;);</span>
<span class="fc" id="L180">				eventMonkeyStrategyDTO.setReturnCode(&quot;-11&quot;);</span>
<span class="fc" id="L181">				return;</span>
			} else {
<span class="pc bpc" id="L183" title="2 of 4 branches missed.">				conParam = (eventJobDTO.getDiscoverHostName() != null &amp;&amp; eventJobDTO.getDiscoverHostName().trim() != &quot;&quot;)</span>
<span class="pc" id="L184">						? eventJobDTO.getDiscoverHostName() : eventJobDTO.getDiscoverHostIpAddress();</span>
<span class="fc" id="L185">				logger.debug(DISCOVERSTR);</span>
<span class="fc" id="L186">				execStatus = DISCOVERSTR + eventJobDTO.getDiscoverHostName() + IPADD</span>
<span class="fc" id="L187">						+ eventJobDTO.getDiscoverHostIpAddress();</span>
<span class="fc" id="L188">				pdExecution = true;</span>
<span class="fc" id="L189">				discoverExecution = true;</span>
			}
		}
<span class="fc" id="L192">		List&lt;String&gt; params = setParam(pdExecution, eventJobDTO);</span>
<span class="fc" id="L193">		appUtil = setAppUtilObj(eventJobDTO, pdExecution, discoverExecution, execStatus, eventData, conParam,</span>
				statusStringBuilder,  eventMonkeyStrategyDTO);
<span class="fc" id="L195">		executeScript(params, appUtil, eventJobDTO, statusStringBuilder, eventData, true, eventMonkeyStrategyDTO);</span>
<span class="fc" id="L196">	}</span>

	/**
	 * This method is used to execute a Ansible Shell Script
	 * 
	 * @param eventJobDTO
	 * @param eventData
	 * @return
	 */
	private void executeAnsibleScript(EventJobDTO eventJobDTO, ConcurrentMap&lt;String, String&gt; eventData,  EventMonkeyStrategyDTO eventMonkeyStrategyDTO) {
		String execStatus;
<span class="fc" id="L207">		StringBuilder statusStringBuilder = new StringBuilder();</span>
<span class="fc" id="L208">		List&lt;String&gt; params = new ArrayList&lt;&gt;();</span>
		AppUtil appUtil;
<span class="pc bpc" id="L210" title="1 of 4 branches missed.">		if (eventJobDTO.getPrivateKey() != null &amp;&amp; !eventJobDTO.getPrivateKey().trim().isEmpty()) {</span>
<span class="fc" id="L211">			execStatus = PRVKEYSTR + eventJobDTO.getHostName() + IPADD + eventJobDTO.getIpAdd();</span>
<span class="fc" id="L212">			logger.debug(execStatus);</span>
<span class="fc" id="L213">			eventMonkeyStrategyDTO.setExecStatus(eventMonkeyStrategyDTO.getExecStatus() + &quot;\n&quot; + execStatus);</span>
<span class="fc" id="L214">			eventJobDTO.setExecStatus(eventJobDTO.getExecStatus() + &quot;\n&quot; + execStatus);</span>
<span class="fc" id="L215">			eventData.put(eventJobDTO.getEventId(), eventJobDTO.getExecStatus());</span>

<span class="fc" id="L217">			appUtil = setAppUtilForAnsible(eventJobDTO, eventData, statusStringBuilder, eventMonkeyStrategyDTO);</span>

<span class="fc bfc" id="L219" title="All 2 branches covered.">		} else if (checkPwdCondition(eventJobDTO)) {</span>

<span class="fc" id="L221">			execStatus = PDKEYSTR + eventJobDTO.getHostName() + IPADD + eventJobDTO.getIpAdd();</span>
<span class="fc" id="L222">			logger.debug(execStatus);</span>

<span class="pc bpc" id="L224" title="2 of 4 branches missed.">			String conParam = (eventJobDTO.getHostName() != null &amp;&amp; eventJobDTO.getHostName().trim() != &quot;&quot;)</span>
<span class="pc" id="L225">					? eventJobDTO.getHostName() : eventJobDTO.getIpAdd();</span>
<span class="fc" id="L226">			appUtil = setAppUtilObj(eventJobDTO, true, false, execStatus, eventData, conParam, statusStringBuilder, eventMonkeyStrategyDTO);</span>

<span class="fc" id="L228">		} else {</span>
<span class="pc bpc" id="L229" title="1 of 4 branches missed.">			if (eventJobDTO.getDiscoverUserId() == null || eventJobDTO.getDiscoverPassword() == null) {</span>
<span class="fc" id="L230">				execStatus = DISCERR;</span>
				
<span class="fc" id="L232">				eventMonkeyStrategyDTO.setExecStatus(eventMonkeyStrategyDTO.getExecStatus() + &quot;\n&quot; + execStatus);</span>
<span class="fc" id="L233">				eventJobDTO.setExecStatus(eventJobDTO.getExecStatus() + &quot;\n&quot; + execStatus);</span>
<span class="fc" id="L234">				eventData.put(eventJobDTO.getEventId(), eventJobDTO.getExecStatus() );</span>
				
<span class="fc" id="L236">				eventJobDTO.setReturnCode(&quot;-11&quot;);</span>
<span class="fc" id="L237">				eventMonkeyStrategyDTO.setReturnCode(&quot;-11&quot;);</span>
<span class="fc" id="L238">				return;</span>
			} else {
<span class="pc bpc" id="L240" title="1 of 2 branches missed.">				String conParam = (eventJobDTO.getDiscoverHostName() != null</span>
<span class="pc bpc" id="L241" title="1 of 2 branches missed.">						&amp;&amp; eventJobDTO.getDiscoverHostName().trim() != &quot;&quot;) ? eventJobDTO.getDiscoverHostName()</span>
<span class="pc" id="L242">								: eventJobDTO.getDiscoverHostIpAddress();</span>
<span class="fc" id="L243">				execStatus = DISCOVERSTR + eventJobDTO.getDiscoverHostName() + IPADD</span>
<span class="fc" id="L244">						+ eventJobDTO.getDiscoverHostIpAddress();</span>
<span class="fc" id="L245">				logger.debug(execStatus);</span>

<span class="fc" id="L247">				appUtil = setAppUtilObj(eventJobDTO, true, true, execStatus, eventData, conParam, statusStringBuilder, eventMonkeyStrategyDTO);</span>
			}
		}
<span class="fc" id="L250">		executeScript(params, appUtil, eventJobDTO, statusStringBuilder, eventData, false, eventMonkeyStrategyDTO);</span>
<span class="fc" id="L251">	}</span>

	/**
	 * This method is used to execute a Script
	 * 
	 * @param params
	 * @param appUtil
	 * @param eventJobDTO
	 * @param statusStringBuilder
	 * @param eventData
	 * @param unixScript
	 */
	private void executeScript(List&lt;String&gt; params, AppUtil appUtil, EventJobDTO eventJobDTO,
			StringBuilder statusStringBuilder, ConcurrentMap&lt;String, String&gt; eventData, boolean unixScript, EventMonkeyStrategyDTO eventMonkeyStrategyDTO) {
<span class="pc bpc" id="L265" title="1 of 2 branches missed.">		if (&quot;&quot;.equals(statusStringBuilder.toString())) {</span>
			String returnCode;
<span class="nc bnc" id="L267" title="All 2 branches missed.">			if (unixScript) {</span>
<span class="nc" id="L268">				returnCode = appUtil.executeUNIXScript(eventJobDTO, params, statusStringBuilder, eventData, eventMonkeyStrategyDTO);</span>
			} else {
<span class="nc" id="L270">				returnCode = appUtil.executeAnsibleScript(eventJobDTO, params, statusStringBuilder, eventData, eventMonkeyStrategyDTO);</span>
			}
			
<span class="nc" id="L273">			eventMonkeyStrategyDTO.setExecStatus(eventMonkeyStrategyDTO.getExecStatus() + &quot;\n&quot; + statusStringBuilder.toString());</span>
			//eventJobDTO.setExecStatus(eventJobDTO.getExecStatus() + &quot;\n&quot; + statusStringBuilder.toString());
			
<span class="nc" id="L276">			eventMonkeyStrategyDTO.setReturnCode(returnCode);</span>
<span class="nc" id="L277">			eventJobDTO.setReturnCode(returnCode);</span>
<span class="nc" id="L278">			eventData.put(eventJobDTO.getEventId(), eventJobDTO.getExecStatus());</span>

<span class="nc" id="L280">		} else {</span>
			String execStatus;
<span class="fc bfc" id="L282" title="All 2 branches covered.">			if (unixScript) {</span>
<span class="fc" id="L283">				execStatus = CONNERR + eventJobDTO.getHostName() + &quot; IP: &quot; + eventJobDTO.getIpAdd() + PORTSTR</span>
<span class="fc" id="L284">						+ eventJobDTO.getUserName() + &quot;. So Scenario Execution is terminated.&quot;;</span>
			} else {
<span class="fc" id="L286">				execStatus = ANSIBLERRSTR;</span>
			}
			
<span class="fc" id="L289">			eventMonkeyStrategyDTO.setExecStatus(eventMonkeyStrategyDTO.getExecStatus() + &quot;\n&quot; + execStatus);</span>
<span class="fc" id="L290">			eventJobDTO.setExecStatus(eventJobDTO.getExecStatus() + &quot;\n&quot; + execStatus);</span>
<span class="fc" id="L291">			eventJobDTO.setReturnCode(&quot;-11&quot;);</span>
<span class="fc" id="L292">			eventMonkeyStrategyDTO.setReturnCode(&quot;-11&quot;);</span>
<span class="fc" id="L293">			eventData.put(eventJobDTO.getEventId(), eventJobDTO.getExecStatus() );</span>
		}
<span class="fc" id="L295">	}</span>

	/**
	 * This method sets the script execution parameter.
	 * 
	 * @param pdExecution
	 * @param eventJobDTO
	 * @return
	 */
	private List&lt;String&gt; setParam(boolean pdExecution, EventJobDTO eventJobDTO) {
<span class="fc" id="L305">		List&lt;String&gt; params = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L306" title="All 2 branches covered.">		if (!pdExecution) {</span>
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">			if (eventJobDTO.getProcessName() != null)</span>
<span class="nc" id="L308">				params.add(eventJobDTO.getProcessName());</span>
		} else {
<span class="fc" id="L310">			params.add(eventJobDTO.getServerName());</span>
<span class="pc bpc" id="L311" title="1 of 2 branches missed.">			if (eventJobDTO.getProcessName() != null)</span>
<span class="nc" id="L312">				params.add(eventJobDTO.getProcessName());</span>
		}

<span class="fc" id="L315">		return params;</span>
	}

	/**
	 * This method sets the AppUtil object for UNIX and Ansible script.
	 * 
	 * @param eventJobDTO
	 * @param pdExecution
	 * @param discoverExecution
	 * @param execStatus
	 * @param eventData
	 * @param conParam
	 * @param statusStringBuilder
	 * @return
	 */
	private AppUtil setAppUtilObj(EventJobDTO eventJobDTO, boolean pdExecution, boolean discoverExecution,
			String execStatus, ConcurrentMap&lt;String, String&gt; eventData, String conParam,
			StringBuilder statusStringBuilder, EventMonkeyStrategyDTO eventMonkeyStrategyDTO) {
		AppUtil appUtil;
		
<span class="fc" id="L335">		eventMonkeyStrategyDTO.setExecStatus(eventMonkeyStrategyDTO.getExecStatus() + &quot;\n&quot; + execStatus);</span>
<span class="fc" id="L336">		eventJobDTO.setExecStatus(eventJobDTO.getExecStatus() + &quot;\n&quot; + execStatus);</span>
<span class="fc" id="L337">		eventData.put(eventJobDTO.getEventId(), eventJobDTO.getExecStatus());</span>
<span class="fc bfc" id="L338" title="All 2 branches covered.">		if (pdExecution) {</span>
<span class="fc bfc" id="L339" title="All 2 branches covered.">			if (discoverExecution) {</span>
<span class="fc" id="L340">				appUtil = new AppUtil(eventJobDTO.getDiscoverUserId(), eventJobDTO.getDiscoverPassword(), conParam,</span>
<span class="fc" id="L341">						eventJobDTO.getDiscoverHostPort());</span>
			} else {
<span class="fc" id="L343">				appUtil = new AppUtil(eventJobDTO.getUserName(), eventJobDTO.getPassword(), conParam, &quot;22&quot;);</span>
			}
<span class="fc" id="L345">			appUtil.sessionConPassword(statusStringBuilder);</span>
		} else {
<span class="fc" id="L347">			appUtil = new AppUtil(eventJobDTO.getUserName(), eventJobDTO.getPrivateKey(), conParam, &quot;22&quot;);</span>
<span class="fc" id="L348">			appUtil.sessionConPrvaiteKey(statusStringBuilder);</span>
		}
<span class="fc" id="L350">		return appUtil;</span>
	}

	/**
	 * This method sets the AppUtil object for Ansible script based on private
	 * key.
	 * 
	 * @param eventJobDTO
	 * @param eventData
	 * @param statusStringBuilder
	 * @return
	 */
	private AppUtil setAppUtilForAnsible(EventJobDTO eventJobDTO, ConcurrentMap&lt;String, String&gt; eventData,
			StringBuilder statusStringBuilder, EventMonkeyStrategyDTO eventMonkeyStrategyDTO) {
<span class="fc" id="L364">		AppUtil appUtil = null;</span>
		try {
<span class="fc" id="L366">			URL privateKeyURL = Resources.getResource(EventJobServiceImpl.class, &quot;/ansibleServer/ansiblePrivateKey&quot;);</span>
<span class="fc" id="L367">			appUtil = new AppUtil(env.getProperty(&quot;ansibleUser&quot;), Resources.toString(privateKeyURL, Charsets.UTF_8),</span>
<span class="fc" id="L368">					env.getProperty(&quot;ansibleIP&quot;), env.getProperty(&quot;ansiblePort&quot;));</span>

<span class="fc" id="L370">			appUtil.sessionConPrvaiteKey(statusStringBuilder);</span>

<span class="nc" id="L372">		} catch (Exception e) {</span>
<span class="nc" id="L373">			logger.error(ANSIBLERRSTR + e);</span>
<span class="nc" id="L374">			statusStringBuilder.append(ANSIBLERRSTR + e);</span>
<span class="nc" id="L375">			eventMonkeyStrategyDTO.setExecStatus(eventMonkeyStrategyDTO.getExecStatus() + &quot;\n&quot; + ANSIBLERRSTR);</span>
<span class="nc" id="L376">			eventJobDTO.setExecStatus(eventJobDTO.getExecStatus() + &quot;\n&quot; + ANSIBLERRSTR);</span>
			
<span class="nc" id="L378">			eventJobDTO.setReturnCode(&quot;-11&quot;);</span>
<span class="nc" id="L379">			eventMonkeyStrategyDTO.setReturnCode(&quot;-11&quot;);</span>
<span class="nc" id="L380">			eventData.put(eventJobDTO.getEventId(), eventJobDTO.getExecStatus() );</span>
<span class="fc" id="L381">		}</span>
<span class="fc" id="L382">		return appUtil;</span>
	}

	private boolean checkPwdCondition(EventJobDTO eventJobDTO) {
<span class="pc bpc" id="L386" title="1 of 4 branches missed.">		return eventJobDTO.getPassword() != null &amp;&amp; !eventJobDTO.getPassword().trim().isEmpty()</span>
<span class="pc bpc" id="L387" title="1 of 2 branches missed.">				&amp;&amp; !eventJobDTO.getPassword().trim().equals(eventJobDTO.getUserName().trim());</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>