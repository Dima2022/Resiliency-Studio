<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ApplicationRestController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">resiliency-studio-service</a> &gt; <a href="index.source.html" class="el_package">com.att.tta.rs.controller</a> &gt; <span class="el_source">ApplicationRestController.java</span></div><h1>ApplicationRestController.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 *   BSD License
 *    
 *   Copyright (c) 2017, AT&amp;T Intellectual Property.  All other rights reserved.
 *    
 *   Redistribution and use in source and binary forms, with or without modification, are permitted
 *   provided that the following conditions are met:
 *    
 *   1. Redistributions of source code must retain the above copyright notice, this list of conditions
 *      and the following disclaimer.
 *   2. Redistributions in binary form must reproduce the above copyright notice, this list of
 *      conditions and the following disclaimer in the documentation and/or other materials provided
 *      with the distribution.
 *   3. All advertising materials mentioning features or use of this software must display the
 *      following acknowledgement:  This product includes software developed by the AT&amp;T.
 *   4. Neither the name of AT&amp;T nor the names of its contributors may be used to endorse or
 *      promote products derived from this software without specific prior written permission.
 *    
 *   THIS SOFTWARE IS PROVIDED BY AT&amp;T INTELLECTUAL PROPERTY ''AS IS'' AND ANY EXPRESS OR
 *   IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 *   MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
 *   SHALL AT&amp;T INTELLECTUAL PROPERTY BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 *   PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;  LOSS OF USE, DATA, OR PROFITS;
 *   OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 *   CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
 *   ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
 *   DAMAGE.
 *******************************************************************************/
package com.att.tta.rs.controller;

import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.validation.Valid;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.util.UriComponentsBuilder;

import com.att.ajsc.logging.AjscEelfManager;
import com.att.eelf.configuration.EELFLogger;
import com.att.tta.rs.model.Application;
import com.att.tta.rs.model.ApplicationAdapter;
import com.att.tta.rs.model.FuelDiscover;
import com.att.tta.rs.model.HardwareDetails;
import com.att.tta.rs.model.Server;
import com.att.tta.rs.service.ApplicationService;
import com.att.tta.rs.service.EnvironmentDiscoveryService;
import com.att.tta.rs.service.FuelEnvDiscoveryServiceImpl;
import com.att.tta.rs.service.TeamUserService;
import com.att.tta.rs.util.AppUtil;
import com.att.tta.rs.util.EUtil;
import com.att.tta.rs.util.MessageWrapper;
import com.google.common.collect.Lists;

import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiResponse;
import io.swagger.annotations.ApiResponses;

/**
 * This Class provides certain REST APIs to perform CRUD operations on
 * Application repository.
 * 
 * @author ak983d
 *
 */
@RestController
@Api(value = &quot;Application Rest Controller&quot;, description = &quot;This REST controller provides REST APIs for performing CRUD Operation on Application Repository&quot;)
<span class="fc" id="L79">public class ApplicationRestController {</span>
<span class="fc" id="L80">	private static EELFLogger logger = AjscEelfManager.getInstance().getLogger(ApplicationRestController.class);</span>

	@Autowired
	ApplicationService applicationService;

	@Autowired
	TeamUserService userDetailsService;

	/**
	 * This API returns list of all Application objects available in Application
	 * Repository.
	 * 
	 * @param request
	 * @return
	 */
	@ApiOperation(value = &quot;This API returns all Application Objects present in Elastic Search&quot;, response = ResponseEntity.class)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Returned all Application Objects&quot;),
			@ApiResponse(code = 401, message = &quot;User is not authorized to view requested object&quot;),
			@ApiResponse(code = 404, message = &quot;No Application object found&quot;) })
	@RequestMapping(value = &quot;/api/applications/&quot;, method = RequestMethod.GET)
	public ResponseEntity&lt;Object&gt; getAllApplication() {
<span class="fc" id="L101">		List&lt;Application&gt; applications = Lists.newArrayList(applicationService.findAllApplications());</span>
<span class="pc bpc" id="L102" title="1 of 4 branches missed.">		if (applications == null || applications.isEmpty()) {</span>
<span class="fc" id="L103">			final String error = &quot; No Applications found !!!  &quot;;</span>
<span class="fc" id="L104">			logger.debug(error);</span>
<span class="fc" id="L105">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.NOT_FOUND, error, error);</span>
<span class="fc" id="L106">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}
<span class="fc" id="L108">		return new ResponseEntity&lt;&gt;(decryptAllApplicationPassword(applications), HttpStatus.OK);</span>
	}

	/**
	 * This API returns count of Application objects available in Application
	 * Repository.
	 * 
	 * @param request
	 * @return
	 */
	@ApiOperation(value = &quot;This API returns count of Application objects available in Elastic Search for team name&quot;, response = ResponseEntity.class)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Returned count of Application objects for team name&quot;),
			@ApiResponse(code = 401, message = &quot;User is not authorized to view requested object&quot;),
			@ApiResponse(code = 404, message = &quot;The resource trying to reach is not found&quot;) })
	@RequestMapping(value = &quot;/api/applications/count/&quot;, method = RequestMethod.GET, produces = &quot;application/json&quot;)
	public ResponseEntity&lt;Object&gt; countByTeamName(HttpServletRequest request) {
<span class="fc" id="L124">		final String teamName = userDetailsService.getCurrentTeamForUser(request).getTeamName();</span>
<span class="fc" id="L125">		Long count = applicationService.countByTeamName(teamName);</span>
<span class="fc" id="L126">		logger.debug(&quot;count of applications for team --&gt;&quot; + teamName);</span>
<span class="fc" id="L127">		return new ResponseEntity&lt;&gt;(count.toString(), HttpStatus.OK);</span>
	}

	/**
	 * This API returns list of all Application objects available in Application
	 * Repository under given Team Name.
	 * 
	 * @param request
	 * @return
	 */
	@ApiOperation(value = &quot;This API returns list of all Application objects present in Elastic Search for given team&quot;, response = ResponseEntity.class)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Returned all Application Objects for given team&quot;),
			@ApiResponse(code = 401, message = &quot;User is not authorized to view requested object&quot;),
			@ApiResponse(code = 404, message = &quot;No Application object found for given team&quot;) })
	@RequestMapping(value = &quot;/api/applications/team/&quot;, method = RequestMethod.GET, produces = &quot;application/json&quot;)
	public ResponseEntity&lt;Object&gt; getAllApplicationsForTeam(HttpServletRequest request) {
<span class="fc" id="L143">		final String teamName = userDetailsService.getCurrentTeamForUser(request).getTeamName();</span>

<span class="fc" id="L145">		List&lt;Application&gt; applications = Lists.newArrayList(applicationService.findAllForTeam(teamName));</span>
<span class="pc bpc" id="L146" title="1 of 4 branches missed.">		if (applications == null || applications.isEmpty()) {</span>
<span class="fc" id="L147">			final String error = &quot; No Applications found !!! for Team &quot; + teamName;</span>
<span class="fc" id="L148">			logger.debug(error);</span>
<span class="fc" id="L149">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.NOT_FOUND, error, error);</span>
<span class="fc" id="L150">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}

<span class="fc" id="L153">		return new ResponseEntity&lt;&gt;(decryptAllApplicationPassword(applications), HttpStatus.OK);</span>
	}

	/**
	 * This method is used to decrypt a Private Key and Password.
	 * 
	 * @param application
	 * @return
	 */
	private List&lt;Application&gt; decryptAllApplicationPassword(List&lt;Application&gt; applications) {
<span class="fc bfc" id="L163" title="All 2 branches covered.">		for (Application application : applications) {</span>
<span class="fc" id="L164">			String envName = application.fields().get(&quot;environmentName&quot;);</span>
<span class="pc bpc" id="L165" title="3 of 4 branches missed.">			if (null != application.getEnvironmentMap() &amp;&amp; null!= application.getEnvironmentMap().get(envName)) {</span>
<span class="nc" id="L166">				List&lt;Server&gt; serverList = application.getEnvironmentMap().get(envName).getServerList();</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">				for (Server server : serverList) {</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">					if (null != server.getPassword()) {</span>
<span class="nc" id="L169">						server.setPassword(EUtil.decrypt(server.getPassword()));</span>
					}

<span class="nc bnc" id="L172" title="All 2 branches missed.">					if (null != server.getPrivatekey()) {</span>
<span class="nc" id="L173">						server.setPrivatekey(EUtil.decrypt(server.getPrivatekey()));</span>
					}
<span class="nc" id="L175">				}</span>
			}
<span class="fc" id="L177">		}</span>
<span class="fc" id="L178">		return applications;</span>
	}

	/**
	 * This API returns single Application Object for given Application Id
	 * 
	 * @param request
	 * @param id
	 * @return
	 */
	@ApiOperation(value = &quot;This API returns single Application Object present in Elastic Search for given App ID&quot;, response = ResponseEntity.class)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Returned single Application Object for given App ID&quot;),
			@ApiResponse(code = 401, message = &quot;User is not authorized to view requested object&quot;),
			@ApiResponse(code = 404, message = &quot;No Application object found for given App ID&quot;) })
	@RequestMapping(value = &quot;/api/applications/{id}&quot;, method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity&lt;Object&gt; getApplication(HttpServletRequest request, @PathVariable(&quot;id&quot;) String id) {
<span class="fc" id="L194">		logger.debug(&quot;Fetching Application Object with id &quot; + id);</span>

<span class="fc" id="L196">		final String teamName = userDetailsService.getCurrentTeamForUser(request).getTeamName();</span>
<span class="fc" id="L197">		Application application = applicationService.findOneForTeam(id, teamName);</span>

<span class="fc bfc" id="L199" title="All 2 branches covered.">		if (application == null) {</span>
<span class="fc" id="L200">			final String error = &quot;Application Not found for id &quot; + id;</span>
<span class="fc" id="L201">			logger.debug(error);</span>
<span class="fc" id="L202">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.NOT_FOUND, error, error);</span>
<span class="fc" id="L203">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}
<span class="fc" id="L205">		return new ResponseEntity&lt;&gt;(decryptPassword(application), HttpStatus.OK);</span>
	}

	/**
	 * This API returns single Application Object for given Application Name
	 * 
	 * @param request
	 * @param name
	 * @return
	 */
	@ApiOperation(value = &quot;This API returns single Application Object present in Elastic Search for given App Name&quot;, response = ResponseEntity.class)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Returned Application Object for given App Name&quot;),
			@ApiResponse(code = 401, message = &quot;User is not authorized to view requested object&quot;),
			@ApiResponse(code = 404, message = &quot;No Application object found for given App Name&quot;) })
	@RequestMapping(value = &quot;/api/applications/name/{name}&quot;, method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity&lt;Object&gt; getApplicationsByName(HttpServletRequest request, @PathVariable(&quot;name&quot;) String name) {
<span class="fc" id="L221">		logger.debug(&quot;Fetching Application object with name &quot; + name);</span>

<span class="fc" id="L223">		final String teamName = userDetailsService.getCurrentTeamForUser(request).getTeamName();</span>
<span class="fc" id="L224">		Application application = applicationService.findByApplicationNameAndTeamName(name, teamName);</span>

<span class="fc bfc" id="L226" title="All 2 branches covered.">		if (application == null) {</span>
<span class="fc" id="L227">			final String error = &quot;Application Not found with name: &quot; + name + &quot; for Team: &quot; + teamName;</span>
<span class="fc" id="L228">			logger.debug(error);</span>
<span class="fc" id="L229">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.NOT_FOUND, error, error);</span>
<span class="fc" id="L230">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}
<span class="fc" id="L232">		return new ResponseEntity&lt;&gt;(decryptPassword(application), HttpStatus.OK);</span>
	}

	/**
	 * This method is used to decrypt a Private Key and Password.
	 * 
	 * @param application
	 * @return
	 */
	private Application decryptPassword(Application application) {
<span class="fc" id="L242">		String envName = application.fields().get(&quot;environmentName&quot;);</span>
<span class="pc bpc" id="L243" title="3 of 4 branches missed.">		if (null != application.getEnvironmentMap() &amp;&amp; null != application.getEnvironmentMap().get(envName)) {</span>
<span class="nc" id="L244">			List&lt;Server&gt; serverList = application.getEnvironmentMap().get(envName).getServerList();</span>
<span class="nc bnc" id="L245" title="All 2 branches missed.">			for (Server server : serverList) {</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">				if (null != server.getPassword()) {</span>
<span class="nc" id="L247">					server.setPassword(EUtil.decrypt(server.getPassword()));</span>
				}

<span class="nc bnc" id="L250" title="All 2 branches missed.">				if (null != server.getPrivatekey()) {</span>
<span class="nc" id="L251">					server.setPrivatekey(EUtil.decrypt(server.getPrivatekey()));</span>
				}
<span class="nc" id="L253">			}</span>
		}
<span class="fc" id="L255">		return application;</span>
	}

	/**
	 * This API returns single Application Object for given Application Id and
	 * Category
	 * 
	 * @param request
	 * @param name
	 * @param category
	 * @return
	 */
	@ApiOperation(value = &quot;This API returns Application Objects present in Elastic Search for given App ID and App Category&quot;, response = ResponseEntity.class)
	@ApiResponses(value = {
			@ApiResponse(code = 200, message = &quot;Returned Application Object for given App ID and App Category&quot;),
			@ApiResponse(code = 401, message = &quot;User is not authorized to view requested object&quot;),
			@ApiResponse(code = 404, message = &quot;No Application object found for given App ID and App Category&quot;) })
	@RequestMapping(value = &quot;/api/applications/{name}/{category}&quot;, method = RequestMethod.GET, produces = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity&lt;Object&gt; getApplicationByNameAndCategory(HttpServletRequest request,
			@PathVariable(&quot;name&quot;) String name, @PathVariable(&quot;category&quot;) String category) {

<span class="fc" id="L276">		final String teamName = userDetailsService.getCurrentTeamForUser(request).getTeamName();</span>
<span class="fc" id="L277">		Application application = applicationService.findByApplicationNameAndCategoryAndTeamName(name, category,</span>
				teamName);

<span class="fc bfc" id="L280" title="All 2 branches covered.">		if (application == null) {</span>
<span class="fc" id="L281">			final String error = &quot;application with name &quot; + name + &quot; and category &quot; + category + &quot; not found &quot;</span>
					+ &quot; for Team &quot; + teamName;
<span class="fc" id="L283">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.NOT_FOUND, error, error);</span>
<span class="fc" id="L284">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}

<span class="fc" id="L287">		return new ResponseEntity&lt;&gt;(decryptPassword(application), HttpStatus.OK);</span>
	}

	/**
	 * This API creates an Application object in the repository.
	 * 
	 * @param request
	 * @param application
	 * @param ucBuilder
	 * @return
	 */
	@ApiOperation(value = &quot;This API inserts an Application Object into Elastic Search&quot;, response = ResponseEntity.class)
	@ApiResponses(value = { @ApiResponse(code = 201, message = &quot;Application object successfully inserted into ES&quot;),
			@ApiResponse(code = 401, message = &quot;User is not authorized to perform Add operation&quot;),
			@ApiResponse(code = 409, message = &quot;Application with same name is already exist&quot;),
			@ApiResponse(code = 404, message = &quot;The resource trying to reach is not found&quot;),
			@ApiResponse(code = 400, message = &quot;Input Request object is not valid&quot;) })
	@RequestMapping(value = &quot;/api/application/&quot;, method = RequestMethod.POST, produces = &quot;application/json&quot;, consumes = MediaType.ALL_VALUE)
	public ResponseEntity&lt;Object&gt; addApplication(HttpServletRequest request, @RequestBody Application application,
			UriComponentsBuilder ucBuilder) {

<span class="fc bfc" id="L308" title="All 2 branches covered.">		if (application == null) {</span>
<span class="fc" id="L309">			final String error = &quot;NULL request received to add application&quot;;</span>
<span class="fc" id="L310">			logger.debug(error);</span>
<span class="fc" id="L311">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.BAD_REQUEST, error, error);</span>
<span class="fc" id="L312">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}

<span class="pc bpc" id="L315" title="1 of 4 branches missed.">		if (application.getApplicationName() == null || &quot;&quot;.equals(application.getApplicationName().trim())) {</span>
<span class="fc" id="L316">			final String error = &quot;Application name is empty&quot;;</span>
<span class="fc" id="L317">			logger.debug(error);</span>
<span class="fc" id="L318">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.BAD_REQUEST, error, error);</span>
<span class="fc" id="L319">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}

<span class="fc" id="L322">		final String teamName = userDetailsService.getCurrentTeamForUser(request).getTeamName();</span>
<span class="fc" id="L323">		application.setTeamName(teamName);</span>

<span class="fc bfc" id="L325" title="All 2 branches covered.">		if (applicationService.insertForTeam(application, teamName) == null) {</span>
<span class="fc" id="L326">			final String error = &quot;Application with name &quot; + application.getApplicationName() + &quot; already exist&quot;;</span>
<span class="fc" id="L327">			logger.debug(error);</span>
<span class="fc" id="L328">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.CONFLICT, error, error);</span>
<span class="fc" id="L329">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}

<span class="fc" id="L332">		HttpHeaders headers = new HttpHeaders();</span>
<span class="fc" id="L333">		headers.setLocation(ucBuilder.path(&quot;/applications/{id}&quot;).buildAndExpand(application.getId()).toUri());</span>
<span class="fc" id="L334">		return new ResponseEntity&lt;&gt;(headers, HttpStatus.CREATED);</span>
	}

	/**
	 * This API do a bulk insertion of Application objects.
	 * 
	 * @param request
	 * @param applicationadapter
	 * @param ucBuilder
	 * @return
	 */
	@ApiOperation(value = &quot;This API do bulk insertion of an Application Objects into Elastic Search&quot;, response = ResponseEntity.class)
	@ApiResponses(value = { @ApiResponse(code = 201, message = &quot;Application objects successfully inserted into ES&quot;),
			@ApiResponse(code = 401, message = &quot;User is not authorized to perform Add operation&quot;),
			@ApiResponse(code = 409, message = &quot;Application with same name is already exist&quot;),
			@ApiResponse(code = 404, message = &quot;The resource trying to reach is not found&quot;),
			@ApiResponse(code = 400, message = &quot;Input Request object is not valid&quot;) })
	@RequestMapping(value = &quot;/api/applications/&quot;, method = RequestMethod.POST, produces = &quot;application/json&quot;)
	public ResponseEntity&lt;Object&gt; bulkaddApplication(HttpServletRequest request,
			@RequestBody ApplicationAdapter applicationadapter) {

<span class="nc bnc" id="L355" title="All 2 branches missed.">		if (applicationadapter == null) {</span>
<span class="nc" id="L356">			final String error = &quot;NULL request received to add application&quot;;</span>
<span class="nc" id="L357">			logger.debug(error);</span>
<span class="nc" id="L358">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.BAD_REQUEST, error, error);</span>
<span class="nc" id="L359">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}

<span class="nc" id="L362">		final String teamName = userDetailsService.getCurrentTeamForUser(request).getTeamName();</span>

<span class="nc bnc" id="L364" title="All 2 branches missed.">		for (Application application : applicationadapter.getApplications()) {</span>
<span class="nc bnc" id="L365" title="All 4 branches missed.">			if (application.getApplicationName() == null || &quot;&quot;.equals(application.getApplicationName().trim())) {</span>
<span class="nc" id="L366">				final String error = &quot;Application name cannot be empty&quot;;</span>
<span class="nc" id="L367">				logger.debug(error);</span>
<span class="nc" id="L368">				final MessageWrapper apiError = new MessageWrapper(HttpStatus.BAD_REQUEST, error, error);</span>
<span class="nc" id="L369">				return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
			}

<span class="nc" id="L372">			application.setTeamName(teamName);</span>

<span class="nc bnc" id="L374" title="All 2 branches missed.">			if (applicationService.insertForTeam(application, teamName) == null) {</span>
<span class="nc" id="L375">				final String error = &quot;Application with name &quot; + application.getApplicationName() + &quot; already exist&quot;;</span>
<span class="nc" id="L376">				logger.debug(error);</span>
<span class="nc" id="L377">				final MessageWrapper apiError = new MessageWrapper(HttpStatus.CONFLICT, error, error);</span>
<span class="nc" id="L378">				return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
			}

<span class="nc" id="L381">			logger.debug(&quot;Application saved in ES with id --&gt;&quot; + application.getId());</span>
<span class="nc" id="L382">		}</span>
<span class="nc" id="L383">		HttpHeaders headers = new HttpHeaders();</span>
<span class="nc" id="L384">		return new ResponseEntity&lt;&gt;(headers, HttpStatus.CREATED);</span>
	}

	/**
	 * This API does an update to a Application object for given Application ID
	 * 
	 * @param request
	 * @param id
	 * @param toModifyApplication
	 * @return
	 */
	@ApiOperation(value = &quot;This API updates an Application Objects into Elastic Search&quot;, response = ResponseEntity.class)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Application objects successfully updated into ES&quot;),
			@ApiResponse(code = 401, message = &quot;User is not authorized to perform Update operation&quot;),
			@ApiResponse(code = 409, message = &quot;Application can be changed only by the owning team&quot;),
			@ApiResponse(code = 404, message = &quot;Applicaiton object not found in ES for given App ID&quot;),
			@ApiResponse(code = 400, message = &quot;Input Request object is not valid&quot;) })
	@RequestMapping(value = &quot;/api/applications/{id}&quot;, method = RequestMethod.PUT, produces = &quot;application/json&quot;)
	public ResponseEntity&lt;Object&gt; updateApplication(HttpServletRequest request, @PathVariable(&quot;id&quot;) String id,
			@RequestBody Application toModifyApplication) {
<span class="fc" id="L404">		logger.debug(&quot;Updating Application with ID: &quot; + id);</span>

<span class="fc" id="L406">		final String teamName = userDetailsService.getCurrentTeamForUser(request).getTeamName();</span>

<span class="pc bpc" id="L408" title="1 of 2 branches missed.">		if (!AppUtil.getSuperUser().equalsIgnoreCase(toModifyApplication.getTeamName())</span>
<span class="fc bfc" id="L409" title="All 2 branches covered.">				&amp;&amp; !toModifyApplication.getTeamName().equalsIgnoreCase(teamName)) {</span>

<span class="fc" id="L411">			final String error = &quot;Application can be changed only by the owning Team --&gt;&quot;</span>
<span class="fc" id="L412">					+ toModifyApplication.getTeamName() + &quot;&lt;--&quot;;</span>
<span class="fc" id="L413">			logger.debug(error);</span>
<span class="fc" id="L414">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.CONFLICT, error, error);</span>
<span class="fc" id="L415">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}

<span class="fc" id="L418">		Application currentApplication = applicationService.findOneForTeam(id, teamName);</span>
<span class="fc bfc" id="L419" title="All 2 branches covered.">		if (currentApplication == null) {</span>
<span class="fc" id="L420">			final String error = &quot;Application with id &quot; + id + &quot; not found&quot;;</span>
<span class="fc" id="L421">			logger.debug(error);</span>
<span class="fc" id="L422">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.NOT_FOUND, error, error);</span>
<span class="fc" id="L423">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}

<span class="fc" id="L426">		toModifyApplication.setId(id);</span>
<span class="fc" id="L427">		toModifyApplication.setTeamName(teamName);</span>
<span class="fc" id="L428">		applicationService.update(toModifyApplication);</span>
<span class="fc" id="L429">		return new ResponseEntity&lt;&gt;(toModifyApplication, HttpStatus.OK);</span>
	}

	/**
	 * This API deletes an Application based on given Application ID
	 * 
	 * @param request
	 * @param id
	 * @return
	 */
	@ApiOperation(value = &quot;This API deletes an Application Objects from Elastic Search&quot;, response = ResponseEntity.class)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Application object successfully deleted from ES&quot;),
			@ApiResponse(code = 401, message = &quot;User is not authorized to perform Delete operation&quot;),
			@ApiResponse(code = 409, message = &quot;Application can be delted only by the owning team&quot;),
			@ApiResponse(code = 404, message = &quot;Applicaiton object not found in ES for given App ID&quot;),
			@ApiResponse(code = 400, message = &quot;Input Request object is not valid&quot;) })
	@RequestMapping(value = &quot;/api/applications/{id}&quot;, method = RequestMethod.DELETE, produces = &quot;application/json&quot;)
	public ResponseEntity&lt;Object&gt; deleteApplication(HttpServletRequest request, @PathVariable(&quot;id&quot;) String id) {
<span class="fc" id="L447">		logger.debug(&quot;Deleting Application with id: &quot; + id);</span>

<span class="fc" id="L449">		final String teamName = userDetailsService.getCurrentTeamForUser(request).getTeamName();</span>
<span class="fc" id="L450">		Application application = applicationService.findOneForTeam(id, teamName);</span>

<span class="fc bfc" id="L452" title="All 2 branches covered.">		if (application == null) {</span>
<span class="fc" id="L453">			final String error = &quot;Unable to delete. Application with id &quot; + id + &quot; not found&quot;;</span>
<span class="fc" id="L454">			logger.debug(error);</span>
<span class="fc" id="L455">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.NOT_FOUND, error, error);</span>
<span class="fc" id="L456">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}

<span class="pc bpc" id="L459" title="1 of 2 branches missed.">		if (!AppUtil.getSuperUser().equalsIgnoreCase(application.getTeamName())</span>
<span class="fc bfc" id="L460" title="All 2 branches covered.">				&amp;&amp; !application.getTeamName().equalsIgnoreCase(teamName)) {</span>
<span class="fc" id="L461">			final String error = &quot;Application can be deleted only by the owning Team &quot; + application.getTeamName();</span>
<span class="fc" id="L462">			logger.debug(error);</span>
<span class="fc" id="L463">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.CONFLICT, error, error);</span>
<span class="fc" id="L464">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}

<span class="fc" id="L467">		applicationService.delete(application);</span>
<span class="fc" id="L468">		return new ResponseEntity&lt;&gt;(HttpStatus.OK);</span>
	}

	/**
	 * This API deletes All Applications
	 * 
	 * @return
	 */
	@ApiOperation(value = &quot;This API deletes all Application Objects from Elastic Search&quot;, response = ResponseEntity.class)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;All Application object successfully deleted from ES&quot;),
			@ApiResponse(code = 401, message = &quot;User is not authorized to perform Delete operation&quot;),
			@ApiResponse(code = 400, message = &quot;Input Request object is not valid&quot;) })
	@RequestMapping(value = &quot;/api/applications/&quot;, method = RequestMethod.DELETE, produces = &quot;application/json&quot;)
	public ResponseEntity&lt;Object&gt; deleteAllApplications() {
<span class="nc" id="L482">		logger.debug(&quot;Deleting All Applications&quot;);</span>
<span class="nc" id="L483">		applicationService.deleteAllApplications();</span>
<span class="nc" id="L484">		return new ResponseEntity&lt;&gt;(HttpStatus.OK);</span>
	}

	/**
	 * This API discovers Server details by executing UNIX script using SSH
	 * connection
	 * 
	 * @param request
	 * @param discoverRequest
	 * @return
	 */
	@ApiOperation(value = &quot;This API returns Server Hardware details after discovery&quot;, response = ResponseEntity.class)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Returned Server Hardware details after discovery&quot;),
			@ApiResponse(code = 401, message = &quot;User is not authorized to view requested object&quot;),
			@ApiResponse(code = 400, message = &quot;Input Request object is not valid&quot;),
			@ApiResponse(code = 404, message = &quot;No Server Hardware details found&quot;) })
	@RequestMapping(value = &quot;/api/applications/discoverServerDetails/&quot;, method = RequestMethod.POST, produces = &quot;application/json&quot;, headers = &quot;Accept=application/json&quot;)
	public ResponseEntity&lt;Object&gt; discoverServerDetailsForApplication(HttpServletRequest request,
			@RequestBody @Valid FuelDiscover discoverRequest) {
<span class="nc" id="L503">		logger.debug(&quot;Discovering Server details for  Host &quot; + discoverRequest.getHostName());</span>

<span class="nc" id="L505">		EnvironmentDiscoveryService environmentDiscoveryService = new FuelEnvDiscoveryServiceImpl();</span>
<span class="nc" id="L506">		HardwareDetails hardwareInfo = environmentDiscoveryService.discoverServerHardwareDetails(discoverRequest);</span>

<span class="nc bnc" id="L508" title="All 2 branches missed.">		if (null == hardwareInfo) {</span>
<span class="nc" id="L509">			final String error = &quot;No Hardware details found for server&quot;;</span>
<span class="nc" id="L510">			logger.debug(error);</span>
<span class="nc" id="L511">			final MessageWrapper apiError = new MessageWrapper(HttpStatus.NOT_FOUND, error, error);</span>
<span class="nc" id="L512">			return new ResponseEntity&lt;&gt;(apiError, new HttpHeaders(), apiError.getStatus());</span>
		}
<span class="nc" id="L514">		return new ResponseEntity&lt;&gt;(hardwareInfo, HttpStatus.OK);</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>